<!DOCTYPE html>
<html>
<body>
<input type="file" id="imageUpload" accept="image/*"> Upload an Image
<br>
<input type="file" id="jsonUpload" accept="application/JSON"> Upload a JSON
<br><br>
<canvas id="myCanvas" width="300" height="300" style="border:1px solid #d3d3d3;"></canvas>
<br>
<button onclick="downloadJSON()">Download JSON</button>
<script>
var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");
var coordinates = [];
var img = new Image();
document.getElementById("imageUpload").addEventListener("change", function(event) {
    var file = event.target.files[0];
    var reader = new FileReader();
    reader.onload = function(e) {
        img.onload = function() {
            ctx.clearRect(0, 0, c.width, c.height); // Clear the canvas
            ctx.drawImage(img, 0, 0, c.width, c.height);
            drawCoordinates();
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(file);
});
document.getElementById("jsonUpload").addEventListener("change", function(event) {
    var file = event.target.files[0];
    var reader = new FileReader();
    reader.onload = function(e) {
        coordinates = JSON.parse(e.target.result);
        drawCoordinates();
    };
    reader.readAsText(file);
});
c.addEventListener('click', function(event) {
    var rect = c.getBoundingClientRect();
    var x = Math.round(event.clientX - rect.left);
    var y = Math.round(event.clientY - rect.top);
    var closestDotIndex = coordinates.reduce((closestIndex, currentCoord, index) => {
        var dx = currentCoord[0] - x;
        var dy = currentCoord[1] - y;
        var distance = Math.sqrt(dx*dx + dy*dy);
        return distance < 5 ? index : closestIndex; // If the click is within 5px of the dot, consider it a hit
    }, -1);
    if (closestDotIndex > -1) {
        coordinates.splice(closestDotIndex, 1); // Remove the clicked dot
    } else {
        coordinates.push([x, y]); // Add new dot if no dots were close
    }
    drawCoordinates();
}, false);
function drawCoordinates() {
    ctx.clearRect(0, 0, c.width, c.height);
    ctx.drawImage(img, 0, 0, c.width, c.height);
    ctx.fillStyle = "#FF0000";
    for (var i = 0; i < coordinates.length; i++) {
        ctx.fillRect(coordinates[i][0], coordinates[i][1], 4, 4);
    }
}
function downloadJSON() {
    var json = JSON.stringify(coordinates);
    var filename = prompt("Please enter the JSON filename (without the extension):", "coordinates");
    if (filename !== null && filename !== "") {
        var blob = new Blob([json], { type: "application/json" });
        var url = URL.createObjectURL(blob);
        var link = document.createElement("a");
        link.href = url;
        link.download = filename + ".json";
        link.click();
        URL.revokeObjectURL(url);
    }
}
</script>
</body>
</html>